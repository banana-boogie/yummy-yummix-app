#!/bin/sh

# Get list of staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM)

# Check if any yyx-app files are staged
YYX_APP_FILES=$(echo "$STAGED_FILES" | grep "^yyx-app/" || true)
if [ -n "$YYX_APP_FILES" ]; then
  echo "üîç Running lint-staged for yyx-app..."
  cd yyx-app && npx lint-staged
  cd ..
fi

# Check if any yyx-server files are staged
YYX_SERVER_FILES=$(echo "$STAGED_FILES" | grep "^yyx-server/supabase/functions/" || true)
if [ -n "$YYX_SERVER_FILES" ]; then
  echo "üîç Running deno fmt for yyx-server..."
  cd yyx-server && deno task fmt
  cd ..
  # Re-add formatted files
  echo "$YYX_SERVER_FILES" | xargs git add

  echo "üîç Running deno lint for yyx-server..."
  cd yyx-server && deno lint supabase/functions/
  cd ..
fi

echo "‚úÖ Pre-commit checks passed"
